# 오늘 할 일

- [x] 자바스크립트 공부
- [x] 리액트 공부

---

# 오늘 한 일 (회고)

- 세션, 쿠키, 토큰에 대한 학습을 진행했다.

  - 지금까지 진행했던 프로젝트 중 '로그인'이라는 기능에 대해서 심도 있게 다뤄본 적이 없는 것 같다는 생각이 들었다. 하지만, 로그인은 어느 서비스를 만들던간에 꼭 필요한 기능이고, 깊이 있는 이해가 필요하다고 느꼈다. 최근 진행했던 프로젝트인 kiwee는 OAuth로 jwt를 통한 인증을 한다. next-auth라는 강력한 토큰 관리 라이브러리가 있었기 때문에 세션이나 쿠키에 대한 고려는 깊이 하지 않고, 필요한 기능만 가져다 사용했었는데, 너무 편리하게 사용할 수 있다 보니 깊은 이해를 하고 사용하진 않았다.
  - 현재 kiwee의 로그인 플로우는 다음과 같다.

    1. 사용자가 SNS 인증 서버로 로그인 요청(OAuth)
    2. 로그인 페이지로 리다이렉트
    3. 로그인 성공 시 인증 서버에서 토큰과 개인정보를 받고 next-auth에 반환
    4. next-auth에서 JWT 기반의 세션을 생성하고 api server에 회원 정보 저장 및 업데이트
    5. 이후 로그인 된 사용자가 특정 기능을 요청하면 next-auth에서 토큰을 검증하고 api server에 요청

    next-auth에서는 useSession이라는 훅을 통해 사용자의 로그인 여부를 전역에서 편리하게 사용할 수 있다.

  - kiwee에서 토큰은 쿠키에 저장된다. 토큰은 로컬스토리지 혹은 쿠키에 저장될 수 있는데, 쿠키는 로컬스토리지에 비해 XSS 공격에 비해 안전하지만, CSRF 공격에 취약하다는 단점이 있다. 그래서 가장 좋은 방법은 리프레시 토큰을 사용하는 것이라고 한다. 리프레시 토큰을 httpOnly 쿠키로 설정하고 url이 새로고침 될 때마다 리프레시 토큰을 요청에 담아 새로운 액세스 토큰을 발급받는 것이다. 이러한 경우, 리프레시 토큰이 CSRF에 의해 사용되어도 공격자는 액세스 토큰을 알 수 없는 것이라고 한다.

- 리액트의 '불변성'이라는 개념이 조금 헷갈리는 부분이 있었는데, 정리가 좀 된 것 같다.
  - 어떤 배열을 상태로 가질 때, push나 pop 등의 메서드를 사용한다면, 이 배열은 새롭게 렌더링 되지 않는다. 그 이유는 리액트는 얕은 비교를 수행하는데, 실제로 배열의 메모리에는 변화가 없기 때문이다. 그렇기 때문에 스프레드 연산자를 통해 새로운 배열을 만들어 상태를 변경시켜주어야 하는 것이다.

---

# 내일 할 일

- [ ] 자바스크립트 공부
